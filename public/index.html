<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ú® Beauty Products Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    .back-btn { text-decoration: none; color: #333; font-size: 18px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .cart { font-size: 24px; }
    .search-container {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .search-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .search-input input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    .search-input button {
      padding: 12px 20px;
      background: #6200ea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .search-input button:hover { background: #3700b3; }
    .topics { margin-bottom: 20px; }
    .topic-btn {
      background: #f0f0f0;
      border: none;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    .topic-btn:hover { background: #e0e0e0; }
    .status { 
      color: green; 
      margin: 10px 0; 
      padding: 10px;
      background: #e8f5e8;
      border-radius: 5px;
    }
    .error { 
      color: red; 
      padding: 10px;
      background: #ffe6e6;
      border-radius: 5px;
      margin: 10px 0;
    }
    #product-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .product-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .product-name {
      font-size: 18px;
      font-weight: bold;
      margin: 0 0 10px 0;
      color: #333;
    }
    .product-price {
      font-size: 20px;
      font-weight: bold;
      color: #28a745;
      margin: 10px 0;
    }
    .product-brand {
      color: #666;
      margin: 5px 0;
    }
    .product-description {
      color: #777;
      font-size: 14px;
      margin: 10px 0;
    }
    .add-to-basket {
      width: 100%;
      padding: 10px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 16px;
    }
    .add-to-basket:hover {
      background: #218838;
    }
    .loading-message, .error-message {
      text-align: center;
      padding: 40px;
      border-radius: 8px;
      grid-column: 1 / -1;
    }
    .loading-message {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .error-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    #load-more {
      grid-column: 1 / -1;
      text-align: center;
      margin-top: 20px;
    }
    .load-more-button {
      padding: 12px 24px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    .load-more-button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="/index.html" class="back-btn">‚Üê Back</a>
    <span class="cart">üõí <span id="basket-count">0</span></span>
  </div>
  
  <h1>‚ú® Beauty Products Search</h1>
  
  <div class="search-container">
    <div id="status" class="status">‚úÖ Ready to search for beauty products!</div>
    
    <div class="search-input">
      <input type="text" id="messageInput" placeholder="Search for beauty products..." value="global" />
      <button onclick="sendMessage()">üîç Search</button>
      <button onclick="refreshSearch()">üîÑ Clear</button>
    </div>
    
    <div class="topics">
      <button class="topic-btn" onclick="quickSearch('global')">üåç Global Beauty</button>
      <button class="topic-btn" onclick="quickSearch('k-beauty')">üå∏ K-Beauty</button>
      <button class="topic-btn" onclick="quickSearch('anti-aging')">‚è∞ Anti-Aging</button>
      <button class="topic-btn" onclick="quickSearch('eye care')">üëÅÔ∏è Eye Care</button>
      <button class="topic-btn" onclick="quickSearch('tanning')">‚òÄÔ∏è Tanning</button>
      <button class="topic-btn" onclick="quickSearch('eyelashes')">üëÅÔ∏è‚Äçüó®Ô∏è Eyelashes</button>
      <button class="topic-btn" onclick="quickSearch('lip products')">üíã Lip Products</button>
    </div>
  </div>

  <div id="product-list">
    <div class="loading-message">Click search to find beauty products...</div>
  </div>
  
  <div id="load-more" style="display: none;"></div>

  <script>
    // CORS Proxy to bypass CORS issues
    const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
    const API_URL = 'https://beauty-ai-backend.onrender.com';
    
    let currentProducts = [];
    let displayedProducts = 0;
    const productsPerPage = 50;

    // Initialize basket count
    let basketCount = parseInt(localStorage.getItem('basketCount') || '0');
    const basketCountElement = document.getElementById('basket-count');
    if (basketCountElement) {
        basketCountElement.textContent = basketCount;
    }

    // Update status
    function setStatus(message, isError = false) {
      const statusElement = document.getElementById('status');
      statusElement.textContent = message;
      statusElement.className = isError ? 'error' : 'status';
    }

    // Search products using CORS proxy
    async function searchProducts(query) {
      const productList = document.getElementById('product-list');
      
      try {
        setStatus('üîç Searching for products...');
        productList.innerHTML = '<div class="loading-message">üîç Searching for products...</div>';
        
        // Use CORS proxy to bypass CORS issues
        const searchUrl = `${API_URL}/api/products/search?q=${encodeURIComponent(query || 'global')}`;
        const proxyUrl = `${CORS_PROXY}${encodeURIComponent(searchUrl)}`;
        
        console.log('Searching with proxy:', proxyUrl);
        
        const response = await fetch(proxyUrl);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('Search response:', data);
        
        if (data.success && data.products && data.products.length > 0) {
          currentProducts = data.products;
          displayedProducts = 0;
          productList.innerHTML = '';
          renderProducts();
          toggleLoadMoreButton();
          
          setStatus(`‚úÖ Found ${data.products.length} products! Source: ${data.stats?.source || 'local'}`);
        } else {
          productList.innerHTML = '<div class="error-message">No products found. Try a different search term.</div>';
          setStatus('‚ùå No products found for your search.', true);
        }
        
      } catch (error) {
        console.error('Search failed:', error);
        productList.innerHTML = `<div class="error-message">‚ùå Search failed: ${error.message}<br>This might be a CORS issue. Try updating your server CORS settings.</div>`;
        setStatus(`‚ùå Search failed: ${error.message}`, true);
      }
    }

    // Render products
    function renderProducts() {
      const productList = document.getElementById('product-list');
      const nextBatch = currentProducts.slice(displayedProducts, displayedProducts + productsPerPage);
      displayedProducts += nextBatch.length;

      const html = nextBatch.map(product => {
        const price = parseFloat(product.price) || 0;
        return `
          <div class="product-card">
            <h3 class="product-name">${escapeHtml(product.name)}</h3>
            <p class="product-brand"><strong>Brand:</strong> ${escapeHtml(product.brand)}</p>
            <p class="product-price">$${price.toFixed(2)}</p>
            <p class="product-brand"><strong>Category:</strong> ${escapeHtml(product.category || 'Beauty')}</p>
            <p class="product-brand"><strong>Origin:</strong> ${escapeHtml(product.country || 'Global')}</p>
            <p class="product-description">${escapeHtml(product.description)}</p>
            <button class="add-to-basket" onclick="addToBasket('${escapeHtml(product.id)}', '${escapeHtml(product.name)}', '${price.toFixed(2)}')">
              Add to Basket
            </button>
          </div>
        `;
      }).join('');
      
      if (displayedProducts === nextBatch.length) {
        productList.innerHTML = html;
      } else {
        productList.innerHTML += html;
      }
      
      toggleLoadMoreButton();
    }

    // Toggle Load More button
    function toggleLoadMoreButton() {
      const loadMoreDiv = document.getElementById('load-more');
      if (loadMoreDiv) {
        if (currentProducts.length > displayedProducts) {
          loadMoreDiv.innerHTML = '<button class="load-more-button" onclick="loadMoreProducts()">Load More Products</button>';
          loadMoreDiv.style.display = 'block';
        } else {
          loadMoreDiv.style.display = 'none';
        }
      }
    }

    // Load more products
    function loadMoreProducts() {
      renderProducts();
    }

    // Add to basket
    function addToBasket(id, name, price) {
      try {
        const basket = JSON.parse(localStorage.getItem('basket') || '[]');
        basket.push({ 
          id, 
          name, 
          price: parseFloat(price), 
          addedAt: new Date().toISOString() 
        });
        localStorage.setItem('basket', JSON.stringify(basket));
        
        basketCount++;
        localStorage.setItem('basketCount', basketCount);
        basketCountElement.textContent = basketCount;
        
        // Visual feedback
        basketCountElement.style.transform = 'scale(1.3)';
        basketCountElement.style.color = '#28a745';
        setTimeout(() => {
          basketCountElement.style.transform = 'scale(1)';
          basketCountElement.style.color = '';
        }, 300);
        
        alert(`‚úÖ Added ${name} to basket!`);
        
      } catch (error) {
        console.error('Error adding to basket:', error);
        alert('‚ùå Error adding item to basket');
      }
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    // Quick search
    function quickSearch(query) {
      document.getElementById('messageInput').value = query;
      searchProducts(query);
    }

    // Send message
    function sendMessage() {
      const query = document.getElementById('messageInput').value.trim();
      searchProducts(query);
    }

    // Refresh search
    function refreshSearch() {
      document.getElementById('messageInput').value = '';
      document.getElementById('product-list').innerHTML = '<div class="loading-message">Click search to find beauty products...</div>';
      document.getElementById('load-more').style.display = 'none';
      currentProducts = [];
      displayedProducts = 0;
      setStatus('‚úÖ Ready to search for beauty products!');
    }

    // Handle Enter key
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    // Initialize
    window.addEventListener('load', function() {
      console.log('üöÄ Beauty Products Search initialized');
      setStatus('‚úÖ Ready to search for beauty products!');
    });
  </script>
</body>
</html>
 
