<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug: Find the 200 Limit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .debug {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
    </style>
</head>
<body>
    <h1>üîç Debug: Find the 200 Product Limit</h1>
    
    <div class="container">
        <h2>üîß Debug Tests</h2>
        <p>These tests will help us find where the 200-product limit is coming from.</p>
        
        <button onclick="testApiKeys()">1. Check API Keys</button>
        <button onclick="testAllProducts()">2. Test All Products</button>
        <button onclick="testDebugSearch()">3. Debug Search Logic</button>
        <button onclick="testRegularSearch()">4. Test Regular Search</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div class="container">
        <h2>üìä Results</h2>
        <div id="results"></div>
    </div>
    
    <div class="container">
        <h2>üêõ Debug Log</h2>
        <div id="debug" class="debug">Debug information will appear here...\n</div>
    </div>

    <script>
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const API_URL = 'https://beauty-ai-backend.onrender.com';
        
        const debugElement = document.getElementById('debug');
        const resultsElement = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üí¨';
            debugElement.textContent += `${timestamp} ${prefix} ${message}\n`;
            debugElement.scrollTop = debugElement.scrollHeight;
        }

        function addResult(title, data, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            resultsElement.appendChild(div);
        }

        function clearResults() {
            resultsElement.innerHTML = '';
            debugElement.textContent = 'Debug cleared...\n';
        }

        // Test 1: Check if API keys are working
        async function testApiKeys() {
            log('Testing API key status...');
            
            try {
                const url = `${CORS_PROXY}${encodeURIComponent(API_URL + '/debug/keys')}`;
                const response = await fetch(url);
                const data = await response.json();
                
                log(`API Keys Status:`, 'success');
                log(`- Rainforest: ${data.rainforestEnabled ? 'ENABLED' : 'DISABLED'} (${data.rainforestKeyLength} chars)`);
                log(`- Claude: ${data.claudeEnabled ? 'ENABLED' : 'DISABLED'} (${data.claudeKeyLength} chars)`);
                
                addResult('üîë API Keys Status', data, data.rainforestEnabled && data.claudeEnabled ? 'success' : 'error');
                
            } catch (error) {
                log(`API Keys test failed: ${error.message}`, 'error');
                addResult('üîë API Keys Test', { error: error.message }, 'error');
            }
        }

        // Test 2: Get ALL products from database
        async function testAllProducts() {
            log('Testing ALL products endpoint...');
            
            try {
                const url = `${CORS_PROXY}${encodeURIComponent(API_URL + '/test/all-products')}`;
                const response = await fetch(url);
                const data = await response.json();
                
                log(`ALL Products Test:`, 'success');
                log(`- Total products: ${data.totalProducts}`);
                log(`- Products returned: ${data.products.length}`);
                log(`- Categories: ${JSON.stringify(data.categories)}`);
                
                if (data.products.length === data.totalProducts) {
                    log(`‚úÖ SUCCESS: All products returned without limits!`, 'success');
                    addResult('üìä All Products Test', {
                        totalProducts: data.totalProducts,
                        productsReturned: data.products.length,
                        categories: data.categories,
                        status: 'ALL PRODUCTS RETURNED - NO LIMITS'
                    }, 'success');
                } else {
                    log(`‚ùå ISSUE: Only ${data.products.length} of ${data.totalProducts} returned`, 'error');
                    addResult('üìä All Products Test', {
                        totalProducts: data.totalProducts,
                        productsReturned: data.products.length,
                        status: 'LIMIT DETECTED!'
                    }, 'error');
                }
                
            } catch (error) {
                log(`All products test failed: ${error.message}`, 'error');
                addResult('üìä All Products Test', { error: error.message }, 'error');
            }
        }

        // Test 3: Debug search logic
        async function testDebugSearch() {
            log('Testing debug search endpoint...');
            
            try {
                const url = `${CORS_PROXY}${encodeURIComponent(API_URL + '/debug/search?q=global')}`;
                const response = await fetch(url);
                const data = await response.json();
                
                log(`Debug Search Results:`, 'success');
                log(`- Total in database: ${data.totalInDatabase}`);
                log(`- Local products found: ${data.localProductsFound}`);
                log(`- After deduplication: ${data.afterDeduplication}`);
                log(`- Final count: ${data.finalCount}`);
                log(`- Products returned: ${data.products.length}`);
                
                if (data.finalCount === data.products.length) {
                    log(`‚úÖ SUCCESS: Debug search returns all products!`, 'success');
                } else {
                    log(`‚ùå ISSUE: finalCount (${data.finalCount}) != products.length (${data.products.length})`, 'error');
                }
                
                addResult('üîç Debug Search Test', {
                    totalInDatabase: data.totalInDatabase,
                    localProductsFound: data.localProductsFound,
                    afterDeduplication: data.afterDeduplication,
                    finalCount: data.finalCount,
                    productsReturned: data.products.length,
                    breakdown: data.stats.breakdown
                }, data.finalCount === data.products.length ? 'success' : 'error');
                
            } catch (error) {
                log(`Debug search test failed: ${error.message}`, 'error');
                addResult('üîç Debug Search Test', { error: error.message }, 'error');
            }
        }

        // Test 4: Regular search endpoint
        async function testRegularSearch() {
            log('Testing regular search endpoint...');
            
            try {
                const url = `${CORS_PROXY}${encodeURIComponent(API_URL + '/api/products/search?q=global')}`;
                const response = await fetch(url);
                const data = await response.json();
                
                log(`Regular Search Results:`, 'success');
                log(`- Success: ${data.success}`);
                log(`- Products returned: ${data.products.length}`);
                log(`- Source: ${data.stats.source}`);
                log(`- Rainforest count: ${data.stats.rainforestCount || 0}`);
                log(`- Claude count: ${data.stats.claudeCount || 0}`);
                log(`- Local count: ${data.stats.localCount || 0}`);
                
                if (data.products.length === 200) {
                    log(`‚ùå FOUND THE ISSUE: Regular search limited to exactly 200!`, 'error');
                } else if (data.products.length > 1000) {
                    log(`‚úÖ SUCCESS: Regular search returns many products!`, 'success');
                } else {
                    log(`‚ö†Ô∏è WARNING: Regular search returns ${data.products.length} products`, 'error');
                }
                
                addResult('üöÄ Regular Search Test', {
                    success: data.success,
                    productsReturned: data.products.length,
                    source: data.stats.source,
                    rainforestCount: data.stats.rainforestCount || 0,
                    claudeCount: data.stats.claudeCount || 0,
                    localCount: data.stats.localCount || 0,
                    status: data.products.length === 200 ? 'LIMIT DETECTED AT 200!' : 'No 200 limit'
                }, data.products.length === 200 ? 'error' : 'success');
                
            } catch (error) {
                log(`Regular search test failed: ${error.message}`, 'error');
                addResult('üöÄ Regular Search Test', { error: error.message }, 'error');
            }
        }

        // Initialize
        window.addEventListener('load', function() {
            log('üöÄ Debug test page initialized');
            log('Click the test buttons to find the 200-product limit issue');
        });
    </script>
</body>
</html>
 
