<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
<title>Beauty Chat - Luminous AI</title>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#B8860B" name="theme-color"/>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-charcoal: #2C2C2C;
            --luminous-gold: #B8860B;
            --pearl-white: #F8F8F8;
            --premium-gradient: linear-gradient(135deg, #B8860B, #DAA520);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-charcoal);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            background: var(--primary-charcoal);
            min-height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--primary-charcoal);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #3A3A3A;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--premium-gradient);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cart-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--premium-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            position: relative;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            min-width: 16px;
            text-align: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: white;
            background: var(--premium-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .chat-area {
            flex: 1;
            padding: 20px;
            background: var(--pearl-white);
            color: #333;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .welcome-message {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-action-btn {
            background: var(--premium-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 16px;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: var(--premium-gradient);
            color: white;
        }

        .products-header {
            background: var(--premium-gradient);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0 15px 0;
            text-align: center;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 80px;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--premium-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }

        .product-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--luminous-gold);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 8px;
            font-weight: bold;
        }

        .product-name {
            font-weight: 700;
            font-size: 12px;
            color: var(--primary-charcoal);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .product-brand {
            font-size: 10px;
            color: #666;
            margin-bottom: 4px;
        }

        .product-price {
            font-size: 14px;
            color: var(--luminous-gold);
            font-weight: 700;
            margin-bottom: 4px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 6px;
        }

        .stars {
            color: #ffd700;
            font-size: 10px;
        }

        .review-count {
            font-size: 9px;
            color: #666;
        }

        .product-country {
            font-size: 9px;
            color: var(--luminous-gold);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .add-to-cart-btn {
            background: var(--premium-gradient);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .add-to-cart-btn:hover {
            transform: scale(1.05);
        }

        .input-area {
            background: var(--primary-charcoal);
            padding: 20px;
            border-top: 1px solid #3A3A3A;
            position: sticky;
            bottom: 0;
        }

        .input-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .refresh-btn {
            background: var(--premium-gradient);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            border-radius: 25px;
            padding: 12px 20px;
        }

        .message-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            background: transparent;
        }

        .send-btn {
            background: var(--premium-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
        }

        .status-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 12px;
            text-align: center;
        }

        .typing-indicator {
            background: #f0f0f0;
            padding: 12px 16px;
            border-radius: 16px;
            max-width: 80%;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<a class="back-btn" href="index.html">‚Üê Back</a>
<div class="logo">‚ú® Beauty Chat</div>
<button class="cart-btn" onclick="toggleCart()">
    üõí
    <span class="cart-count" id="cartCount">0</span>
</button>
</div>

<div class="chat-area" id="chatArea">
<div class="welcome-message">
<h3 style="color: var(--primary-charcoal); margin-bottom: 10px;">Hi! I'm your Beauty AI assistant ‚ú®</h3>
<div class="status-message">‚úÖ Connected to Beauty AI Backend - Real Claude AI responses!</div>
<div class="quick-actions">
<button class="quick-action-btn" onclick="sendQuickMessage('üåç Global Beauty')">üåç Global Beauty</button>
<button class="quick-action-btn" onclick="sendQuickMessage('üì∏ Instagram Trends')">üì∏ Instagram Trends</button>
<button class="quick-action-btn" onclick="sendQuickMessage('üå∏ K-Beauty')">üå∏ K-Beauty</button>
<button class="quick-action-btn" onclick="sendQuickMessage('üõí Amazon Finds')">üõí Amazon Finds</button>
<button class="quick-action-btn" onclick="sendQuickMessage('üåø Natural Beauty')">üåø Natural Beauty</button>
<button class="quick-action-btn" onclick="sendQuickMessage('üíé Luxury Skincare')">üíé Luxury Skincare</button>
</div>
</div>
</div>

<div class="input-area">
<div class="input-controls">
<button class="refresh-btn" onclick="refreshChat()">üîÑ New Chat</button>
</div>
<div class="input-container">
<input class="message-input" id="messageInput" onkeypress="handleKeyPress(event)" placeholder="Ask about beauty products..." type="text"/>
<button class="send-btn" onclick="sendMessage()">‚ñ∂</button>
</div>
</div>
</div>

<script>
        let shoppingCart = JSON.parse(localStorage.getItem('beautyCart')) || [];

        // Initialize cart count
        updateCartDisplay();

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = shoppingCart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'block' : 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (!message) return;

            clearPreviousResults();
            addUserMessage(message);
            messageInput.value = '';

            // Process with backend
            processBeautyQuery(message);
        }

        // üöÄ UPDATED: Connect to your actual backend
        function processBeautyQuery(query) {
            const lowerQuery = query.toLowerCase();
            
            // Show typing indicator
            showTyping();
            
            // Call your actual backend
            fetch('https://beauty-ai-backend.onrender.com/api/chat/claude', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: query,
                    context: 'beauty consultation' 
                })
            })
            .then(response => response.json())
            .then(data => {
                hideTyping();
                
                if (data.success) {
                    // Add Claude's response with typewriter effect
                    addBotMessageWithTypewriter(data.response);
                    
                    // Search for products related to the query
                    return fetch('https://beauty-ai-backend.onrender.com/api/products/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            query: query,
                            limit: 10 
                        })
                    });
                } else {
                    throw new Error(data.error || 'AI chat failed');
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.products.length > 0) {
                    // Show products header
                    showProductsHeader(data.products);
                    
                    // Display products
                    displayProducts(data.products);
                }
            })
            .catch(error => {
                hideTyping();
                console.error('Error:', error);
                addBotMessage('Sorry, I encountered an error. Please try again! ‚ú®');
            });
        }

        // üåü NEW: Typewriter effect for Claude responses
        function addBotMessageWithTypewriter(message) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.minHeight = '20px';
            
            messageDiv.appendChild(contentDiv);
            chatArea.appendChild(messageDiv);
            scrollToBottom();

            // Typewriter effect
            let i = 0;
            const speed = 30; // Typing speed in milliseconds
            
            function typeWriter() {
                if (i < message.length) {
                    contentDiv.innerHTML += message.charAt(i);
                    i++;
                    setTimeout(typeWriter, speed);
                    scrollToBottom();
                }
            }
            
            typeWriter();
        }

        function displayProducts(products) {
            const chatArea = document.getElementById('chatArea');
            const productsGrid = document.createElement('div');
            productsGrid.className = 'products-grid';

            products.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';

                // Generate rating
                const rating = product.rating || (3.5 + Math.random() * 1.5);
                const stars = '‚òÖ'.repeat(Math.floor(rating)) + '‚òÜ'.repeat(5 - Math.floor(rating));
                
                // Product badge
                let badge = '';
                if (product.country === 'South Korea') badge = 'K-BEAUTY';
                else if (parseFloat((product.price || '$0').replace('$', '')) > 50) badge = 'PREMIUM';
                else if (product.category === 'skincare') badge = 'SKINCARE';

                productCard.innerHTML = `
                    ${badge ? `<div class="product-badge">${badge}</div>` : ''}
                    <div class="product-image">‚ú®</div>
                    <div class="product-name">${product.name || 'Beauty Product'}</div>
                    <div class="product-brand">${product.brand || 'Premium Brand'}</div>
                    <div class="product-price">${product.price || '$25.00'}</div>
                    <div class="product-rating">
                        <span class="stars">${stars}</span>
                        <span class="review-count">(${product.reviews || Math.floor(Math.random() * 1000) + 100})</span>
                    </div>
                    <div class="product-country">üåç ${product.country || 'Global'}</div>
                    <button class="add-to-cart-btn" onclick="addToCart('${product.name}', '${product.brand}', '${product.price}')">
                        üõí Add to Cart
                    </button>
                `;

                productCard.onclick = (e) => {
                    if (!e.target.classList.contains('add-to-cart-btn')) {
                        showProductDetails(product);
                    }
                };

                productsGrid.appendChild(productCard);
            });

            chatArea.appendChild(productsGrid);
            scrollToBottom();
        }

        function addToCart(name, brand, price) {
            const cartItem = {
                name: name || 'Beauty Product',
                brand: brand || 'Premium Brand',
                price: price || '$25.00',
                quantity: 1,
                addedAt: new Date().toISOString()
            };

            const existingItem = shoppingCart.find(item => item.name === cartItem.name);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                shoppingCart.push(cartItem);
            }
            
            localStorage.setItem('beautyCart', JSON.stringify(shoppingCart));
            updateCartDisplay();
            
            showNotification(`Added ${name} to cart! üõí`);
        }

        function showProductDetails(product) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                padding: 20px;
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 90%; max-height: 80%; overflow-y: auto; position: relative;">
                    <button onclick="this.closest('[style*=position]').remove()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 28px; cursor: pointer; color: #666;">√ó</button>

                    <div style="text-align: center; margin-bottom: 25px;">
                        <h2 style="color: #2c2c2c; margin-bottom: 8px;">${product.name || 'Beauty Product'}</h2>
                        <p style="color: #666; margin-bottom: 8px; font-weight: 600;">${product.brand || 'Premium Brand'}</p>
                        <p style="color: #B8860B; font-weight: 600; margin-bottom: 16px;">üåç ${product.country || 'Global'}</p>
                        <div style="font-size: 28px; color: #B8860B; font-weight: 700;">${product.price || '$25.00'}</div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #2c2c2c; margin-bottom: 10px;">Description</h3>
                        <p style="color: #666; line-height: 1.5;">${product.description || 'Premium beauty product with high-quality ingredients for exceptional results.'}</p>
                    </div>

                    <div style="text-align: center; display: flex; gap: 10px;">
                        <button onclick="addToCart('${product.name}', '${product.brand}', '${product.price}'); this.closest('[style*=position]').remove();" style="background: var(--premium-gradient); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; flex: 1;">
                            üõí Add to Cart
                        </button>
                        <button onclick="this.closest('[style*=position]').remove()" style="background: #f0f0f0; color: #333; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold;">
                            Close
                        </button>
                    </div>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            document.body.appendChild(modal);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10001;
                background: var(--premium-gradient); color: white;
                padding: 12px 20px; border-radius: 8px;
                font-size: 14px; font-weight: 600;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function clearPreviousResults() {
            const chatArea = document.getElementById('chatArea');
            const messages = chatArea.querySelectorAll('.message, .products-grid, .products-header');
            messages.forEach(message => message.remove());
        }

        function addUserMessage(message) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
            chatArea.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessage(message) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
            chatArea.appendChild(messageDiv);
            scrollToBottom();
        }

        function showProductsHeader(products) {
            const chatArea = document.getElementById('chatArea');
            const headerDiv = document.createElement('div');
            headerDiv.className = 'products-header';
            
            const countries = [...new Set(products.map(p => p.country || 'Global'))];
            
            headerDiv.innerHTML = `
                <h3>üåç Found ${products.length} Beauty Products</h3>
                <div style="font-size: 12px; margin-top: 5px;">
                    From: ${countries.slice(0, 3).join(', ')}${countries.length > 3 ? '...' : ''}
                </div>
            `;
            
            chatArea.appendChild(headerDiv);
        }

        function sendQuickMessage(message) {
            const messageInput = document.getElementById('messageInput');
            
            const enhancedMessages = {
                'üåç Global Beauty': 'Show me beauty products from around the world',
                'üì∏ Instagram Trends': 'What are the trending makeup and beauty looks on Instagram?',
                'üå∏ K-Beauty': 'Show me Korean skincare and K-beauty products',
                'üõí Amazon Finds': 'What are popular beauty products on Amazon?',
                'üåø Natural Beauty': 'Show me natural and organic beauty products',
                'üíé Luxury Skincare': 'Show me luxury and premium skincare products'
            };

            messageInput.value = enhancedMessages[message] || message;
            sendMessage();
        }

        function showTyping() {
            const chatArea = document.getElementById('chatArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = '<div class="message-content typing-indicator">Claude AI is thinking... ‚ú®</div>';
            chatArea.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function refreshChat() {
            clearPreviousResults();
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.value = '';
                messageInput.focus();
            }
        }

        function scrollToBottom() {
            const chatArea = document.getElementById('chatArea');
            setTimeout(() => {
                chatArea.scrollTop = chatArea.scrollHeight;
            }, 100);
        }

        function toggleCart() {
            if (shoppingCart.length === 0) {
                showNotification('üõí Your cart is empty! Add some products first.');
                return;
            }
            
            alert(`üõí Cart: ${shoppingCart.length} items\n\nFull cart functionality available in products page!`);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚ú® Beauty Chat with Backend Connection loaded!');
        });
    </script>
</body>
</html>