<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>✨ Beauty Products Search</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-charcoal: #2C2C2C;
      --luminous-gold: #B8860B;
      --pearl-white: #F8F8F8;
      --premium-gradient: linear-gradient(135deg, #B8860B, #DAA520);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--primary-charcoal);
      color: #333;
      overflow-x: hidden;
      min-height: 100vh;
    }

    .container {
      max-width: 414px;
      margin: 0 auto;
      background: var(--primary-charcoal);
      min-height: 100vh;
      position: relative;
    }

    .header {
      background: var(--primary-charcoal);
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #3A3A3A;
    }

    .back-btn {
      text-decoration: none;
      color: var(--luminous-gold);
      font-size: 18px;
      font-weight: 600;
    }

    .cart {
      font-size: 24px;
      color: white;
      position: relative;
    }

    .cart-count {
      background: var(--luminous-gold);
      color: white;
      border-radius: 10px;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: 700;
      position: absolute;
      top: -8px;
      right: -8px;
      min-width: 20px;
      text-align: center;
    }

    .main-content {
      background: var(--pearl-white);
      min-height: calc(100vh - 140px);
      padding: 20px;
    }

    .search-section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .search-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-charcoal);
      margin-bottom: 8px;
      text-align: center;
    }

    .search-subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      text-align: center;
    }

    .search-bar {
      background: white;
      border-radius: 25px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 2px solid var(--luminous-gold);
      margin-bottom: 20px;
    }

    .search-icon {
      font-size: 20px;
      color: var(--luminous-gold);
    }

    .search-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 16px;
      color: var(--primary-charcoal);
      background: transparent;
    }

    .search-input::placeholder {
      color: #999;
      font-style: italic;
    }

    .search-btn {
      background: var(--premium-gradient);
      border: none;
      border-radius: 20px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 16px;
    }

    .search-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
    }

    .quick-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .category-btn {
      background: var(--pearl-white);
      border: 1px solid var(--luminous-gold);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--primary-charcoal);
    }

    .category-btn:hover {
      background: var(--premium-gradient);
      color: white;
      transform: translateY(-1px);
    }

    .status-section {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .status {
      color: #28a745;
      font-weight: 600;
      font-size: 14px;
    }

    .error {
      color: #dc3545;
      font-weight: 600;
      font-size: 14px;
    }

    .products-section {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 100px;
    }

    .products-header {
      background: var(--premium-gradient);
      color: white;
      padding: 16px;
      text-align: center;
    }

    .products-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .products-subtitle {
      font-size: 12px;
      opacity: 0.9;
    }

    #product-list {
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .product-card {
      background: var(--pearl-white);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border: 1px solid #e9ecef;
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: var(--luminous-gold);
    }

    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      gap: 12px;
    }

    .product-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--primary-charcoal);
      margin: 0;
      line-height: 1.3;
      flex: 1;
    }

    .product-category {
      background: var(--premium-gradient);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    .product-details {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      margin-bottom: 12px;
      align-items: center;
    }

    .product-brand {
      font-size: 14px;
      color: #666;
      margin: 0;
      font-weight: 500;
    }

    .product-price {
      font-size: 20px;
      font-weight: 800;
      color: #28a745;
      margin: 0;
      text-align: right;
    }

    .product-country {
      font-size: 12px;
      color: #666;
      margin: 0;
      font-style: italic;
    }

    .product-description {
      font-size: 14px;
      color: #495057;
      line-height: 1.5;
      margin: 0 0 16px 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .add-to-basket {
      width: 100%;
      padding: 12px 24px;
      background: var(--premium-gradient);
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .add-to-basket:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(184, 134, 11, 0.4);
    }

    .loading-message, .error-message {
      text-align: center;
      padding: 40px 20px;
      font-size: 16px;
      border-radius: 12px;
    }

    .loading-message {
      color: var(--luminous-gold);
      background: #fff9e6;
      border: 1px solid var(--luminous-gold);
    }

    .error-message {
      color: #dc3545;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
    }

    #load-more {
      text-align: center;
      padding: 20px;
    }

    .load-more-button {
      padding: 16px 32px;
      background: var(--premium-gradient);
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .load-more-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(184, 134, 11, 0.4);
    }

    .bottom-nav {
      background: white;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-around;
      border-top: 1px solid #E0E0E0;
      padding-bottom: 20px;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 414px;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: #666;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-item.active {
      color: var(--luminous-gold);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .nav-label {
      font-size: 10px;
      font-weight: 500;
    }

    /* Responsive design */
    @media (max-width: 380px) {
      .container {
        max-width: 100%;
      }
      
      .quick-categories {
        gap: 6px;
      }
      
      .category-btn {
        font-size: 11px;
        padding: 6px 12px;
      }
      
      .product-name {
        font-size: 15px;
      }
      
      .product-price {
        font-size: 18px;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .product-card {
      animation: fadeIn 0.5s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <a href="index.html" class="back-btn">← Back</a>
      <span class="cart">🛒 <span class="cart-count" id="basket-count">0</span></span>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Search Section -->
      <div class="search-section">
        <div class="search-title">✨ Beauty Products Search</div>
        <div class="search-subtitle">Discover 3,100+ products from around the world</div>
        
        <div class="search-bar">
          <div class="search-icon">🔍</div>
          <input type="text" class="search-input" id="messageInput" placeholder="Search for beauty products..." />
          <button class="search-btn" onclick="sendMessage()">🚀</button>
        </div>
        
        <div class="quick-categories">
          <button class="category-btn" onclick="quickSearch('global')">🌍 Global</button>
          <button class="category-btn" onclick="quickSearch('k-beauty')">🌸 K-Beauty</button>
          <button class="category-btn" onclick="quickSearch('anti-aging')">⏰ Anti-Aging</button>
          <button class="category-btn" onclick="quickSearch('eye care')">👁️ Eye Care</button>
          <button class="category-btn" onclick="quickSearch('tanning')">☀️ Tanning</button>
          <button class="category-btn" onclick="quickSearch('eyelashes')">👁️‍🗨️ Eyelashes</button>
          <button class="category-btn" onclick="quickSearch('lip products')">💋 Lip Products</button>
        </div>
      </div>

      <!-- Status Section -->
      <div class="status-section">
        <div id="status" class="status">✅ Ready to search for beauty products!</div>
      </div>

      <!-- Products Section -->
      <div class="products-section">
        <div class="products-header">
          <div class="products-title">Beauty Products</div>
          <div class="products-subtitle">AI-powered recommendations from global experts</div>
        </div>
        
        <div id="product-list">
          <div class="loading-message">Click search or select a category to find products...</div>
        </div>
        
        <div id="load-more" style="display: none;"></div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-item" onclick="goToPage('home', event)">
        <div class="nav-icon">🏠</div>
        <div class="nav-label">Home</div>
      </div>
      <div class="nav-item" onclick="goToPage('signin', event)">
        <div class="nav-icon">🔑</div>
        <div class="nav-label">Sign In</div>
      </div>
      <div class="nav-item" onclick="goToPage('createaccount', event)">
        <div class="nav-icon">👤</div>
        <div class="nav-label">Create Account</div>
      </div>
      <div class="nav-item active" onclick="goToPage('catalog', event)">
        <div class="nav-icon">🌍</div>
        <div class="nav-label">Catalog</div>
      </div>
      <div class="nav-item" onclick="goToPage('askme', event)">
        <div class="nav-icon">💬</div>
        <div class="nav-label">Ask Me</div>
      </div>
    </div>
  </div>

  <script>
    // CORS Proxy to bypass CORS issues
    const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
    const API_URL = 'https://beauty-ai-backend.onrender.com';
    
    let currentProducts = [];
    let displayedProducts = 0;
    let currentPage = 1;
    let totalPages = 1;
    let totalAvailable = 0;
    const productsPerPage = 50;

    // Initialize basket count
    let basketCount = parseInt(localStorage.getItem('basketCount') || '0');
    const basketCountElement = document.getElementById('basket-count');
    if (basketCountElement) {
        basketCountElement.textContent = basketCount;
    }

    // Update status
    function setStatus(message, isError = false) {
      const statusElement = document.getElementById('status');
      statusElement.textContent = message;
      statusElement.className = isError ? 'error' : 'status';
    }

    // Search products using pagination with better error handling
    async function searchProducts(query, page = 1, loadMore = false) {
      const productList = document.getElementById('product-list');
      
      try {
        const cleanQuery = (query || 'global').trim().toLowerCase();
        console.log(`Starting search for: "${cleanQuery}", page: ${page}`);
        
        if (!loadMore) {
          setStatus('🔍 Searching worldwide for products...');
          productList.innerHTML = '<div class="loading-message">🔍 Searching worldwide for products...</div>';
          currentProducts = [];
          displayedProducts = 0;
          currentPage = 1;
        } else {
          setStatus('🔍 Loading more products...');
        }
        
        // Use pagination to avoid response size limits (300 per page works perfectly)
        const searchUrl = `${API_URL}/api/products/search?q=${encodeURIComponent(cleanQuery)}&page=${page}&limit=300`;
        const proxyUrl = `${CORS_PROXY}${encodeURIComponent(searchUrl)}`;
        
        console.log('Search URL:', searchUrl);
        console.log('Proxy URL:', proxyUrl);
        
        const response = await fetch(proxyUrl);
        console.log('Response status:', response.status);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        // Check if response has content
        const responseText = await response.text();
        console.log('Response text length:', responseText.length);
        console.log('Response text preview:', responseText.substring(0, 200));
        
        if (!responseText || responseText.trim() === '') {
          throw new Error('Empty response from server');
        }
        
        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          console.error('JSON parse error:', parseError);
          console.error('Response text that failed to parse:', responseText);
          throw new Error(`Invalid JSON response: ${parseError.message}`);
        }
        
        console.log('Parsed data:', data);
        
        if (data.success && data.products && data.products.length > 0) {
          if (loadMore) {
            currentProducts.push(...data.products);
          } else {
            currentProducts = data.products;
          }
          
          displayedProducts = 0;
          if (!loadMore) {
            productList.innerHTML = '';
          }
          renderProducts();
          
          // Update pagination info
          if (data.pagination) {
            currentPage = data.pagination.currentPage;
            totalPages = data.pagination.totalPages;
            totalAvailable = data.pagination.totalProducts;
          }
          
          toggleLoadMoreButton();
          
          const sourceInfo = data.stats?.source ? ` (${data.stats.source})` : '';
          const currentCount = currentProducts.length;
          const totalCount = data.pagination?.totalProducts || data.stats?.totalAvailable || currentCount;
          
          let statusMsg = `✅ Showing ${currentCount} of ${totalCount} products worldwide${sourceInfo}`;
          
          if (data.pagination && data.pagination.totalPages > 1) {
            statusMsg += ` - Page ${currentPage} of ${totalPages}`;
          }
          
          // Show API breakdown if available
          if (data.stats?.geminiCount > 0 || data.stats?.rainforestCount > 0) {
            const apiInfo = [];
            if (data.stats.geminiCount > 0) apiInfo.push(`${data.stats.geminiCount} from AI`);
            if (data.stats.rainforestCount > 0) apiInfo.push(`${data.stats.rainforestCount} from Amazon`);
            if (data.stats.localCount > 0) apiInfo.push(`${data.stats.localCount} from global database`);
            
            if (apiInfo.length > 0) {
              statusMsg += ` - ${apiInfo.join(', ')}`;
            }
          }
          
          setStatus(statusMsg);
        } else if (data.success === false) {
          // Server returned an error
          const errorMsg = data.error || data.message || 'Unknown server error';
          throw new Error(`Server error: ${errorMsg}`);
        } else {
          if (!loadMore) {
            productList.innerHTML = '<div class="error-message">No products found. Try terms like "skincare", "makeup", "k-beauty", or "anti-aging".</div>';
            setStatus('❌ No products found. Try different search terms.', true);
          }
        }
        
      } catch (error) {
        console.error('Search failed:', error);
        
        let errorMessage = '';
        let userMessage = '';
        
        if (error.message.includes('JSON')) {
          errorMessage = 'Invalid response format from server';
          userMessage = 'Server returned invalid data. This might be a temporary issue.';
        } else if (error.message.includes('Empty response')) {
          errorMessage = 'Server returned empty response';
          userMessage = 'Server didn\'t return any data. Please try again.';
        } else if (error.message.includes('Content-Length')) {
          errorMessage = 'Response too large';
          userMessage = 'Found too many products! Try more specific search terms.';
        } else if (error.message.includes('NetworkError') || error.message.includes('fetch')) {
          errorMessage = 'Network connection failed';
          userMessage = 'Connection failed. Please check your internet connection.';
        } else {
          errorMessage = error.message;
          userMessage = error.message;
        }
        
        if (!loadMore) {
          productList.innerHTML = `
            <div class="error-message">
              ❌ Search failed: ${userMessage}<br>
              <small>Try different search terms or refresh the page.</small><br>
              <button class="load-more-button" onclick="searchProducts('global')" style="margin-top: 15px;">
                Try Global Search
              </button>
            </div>
          `;
          setStatus(`❌ ${errorMessage}`, true);
        }
      }
    }

    // Render products as beautiful cards
    function renderProducts() {
      const productList = document.getElementById('product-list');
      if (!productList) return;
      
      const nextBatch = currentProducts.slice(displayedProducts, displayedProducts + productsPerPage);
      displayedProducts += nextBatch.length;

      const html = nextBatch.map(product => {
        const price = parseFloat(product.price) || 0;
        const formattedPrice = price.toFixed(2);
        
        return `
          <div class="product-card">
            <div class="product-header">
              <h3 class="product-name">${escapeHtml(product.name)}</h3>
              <span class="product-category">${escapeHtml(product.category || 'Beauty')}</span>
            </div>
            <div class="product-details">
              <p class="product-brand">Brand: ${escapeHtml(product.brand)}</p>
              <p class="product-price">$${formattedPrice}</p>
            </div>
            <p class="product-country">Origin: ${escapeHtml(product.country || 'Global')}</p>
            <p class="product-description">${escapeHtml(product.description)}</p>
            <button class="add-to-basket" onclick="addToBasket('${escapeHtml(product.id)}', '${escapeHtml(product.name)}', '${formattedPrice}')">
              Add to Basket
            </button>
          </div>
        `;
      }).join('');
      
      productList.innerHTML += html;
      toggleLoadMoreButton();
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    // Toggle Load More button
    function toggleLoadMoreButton() {
      const loadMoreDiv = document.getElementById('load-more');
      if (loadMoreDiv) {
        if (currentPage < totalPages) {
          loadMoreDiv.innerHTML = `
            <button class="load-more-button" onclick="loadMoreProducts()">
              Load More Products (Page ${currentPage + 1} of ${totalPages})
            </button>
            <p style="text-align: center; color: #666; margin-top: 10px; font-size: 12px;">
              Showing ${currentProducts.length} of ${totalAvailable} total products
            </p>
          `;
          loadMoreDiv.style.display = 'block';
        } else if (currentProducts.length > displayedProducts) {
          loadMoreDiv.innerHTML = '<button class="load-more-button" onclick="renderMoreProducts()">Show More</button>';
          loadMoreDiv.style.display = 'block';
        } else {
          loadMoreDiv.innerHTML = `
            <p style="text-align: center; color: #666; margin-top: 20px; font-size: 14px;">
              ✅ All ${currentProducts.length} products shown
            </p>
          `;
          loadMoreDiv.style.display = 'block';
        }
      }
    }

    // Load more products from next page
    function loadMoreProducts() {
      const query = document.getElementById('messageInput').value.trim() || 'global';
      searchProducts(query, currentPage + 1, true);
    }

    // Render more products from current batch
    function renderMoreProducts() {
      renderProducts();
    }

    // Add to basket
    function addToBasket(id, name, price) {
      try {
        const basket = JSON.parse(localStorage.getItem('basket') || '[]');
        const newItem = { 
          id, 
          name, 
          price: parseFloat(price),
          addedAt: new Date().toISOString()
        };
        
        basket.push(newItem);
        localStorage.setItem('basket', JSON.stringify(basket));
        
        basketCount++;
        localStorage.setItem('basketCount', basketCount);
        
        if (basketCountElement) {
          basketCountElement.textContent = basketCount;
          basketCountElement.style.transform = 'scale(1.3)';
          basketCountElement.style.color = '#28a745';
          setTimeout(() => {
            basketCountElement.style.transform = 'scale(1)';
            basketCountElement.style.color = '';
          }, 300);
        }
        
        // Show success notification
        showNotification(`✅ Added ${name} to basket!`);
        
      } catch (error) {
        console.error('Error adding to basket:', error);
        showNotification('❌ Error adding item to basket');
      }
    }

    // Show notification
    function showNotification(message) {
      // Create temporary notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--premium-gradient);
        color: white;
        padding: 15px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 14px;
        z-index: 10000;
        opacity: 0;
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px rgba(184, 134, 11, 0.4);
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => notification.style.opacity = '1', 100);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 3000);
    }

    // Fallback search without CORS proxy (for testing)
    async function searchProductsDirect(query) {
      const productList = document.getElementById('product-list');
      
      try {
        setStatus('🔧 Trying direct connection...');
        
        const cleanQuery = (query || 'global').trim().toLowerCase();
        const searchUrl = `${API_URL}/api/products/search?q=${encodeURIComponent(cleanQuery)}&page=1&limit=100`;
        
        console.log('Direct search URL:', searchUrl);
        
        const response = await fetch(searchUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
            'X-Request-ID': 'direct-' + Date.now()
          }
        });
        
        console.log('Direct response status:', response.status);
        
        if (!response.ok) {
          throw new Error(`Direct connection failed: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Direct response data:', data);
        
        if (data.success && data.products && data.products.length > 0) {
          currentProducts = data.products;
          displayedProducts = 0;
          productList.innerHTML = '';
          renderProducts();
          
          setStatus(`✅ Direct connection success! Found ${data.products.length} products`);
        } else {
          throw new Error('No products found via direct connection');
        }
        
      } catch (error) {
        console.error('Direct search failed:', error);
        setStatus('❌ Direct connection also failed. Server may be down.', true);
        
        productList.innerHTML = `
          <div class="error-message">
            ❌ Unable to connect to server<br>
            <small>Both proxy and direct connections failed.</small><br>
            <small>The server may be restarting or temporarily unavailable.</small><br>
            <button class="load-more-button" onclick="location.reload()" style="margin-top: 15px;">
              Refresh Page
            </button>
          </div>
        `;
      }
    }

    // Send message
    function sendMessage() {
      const query = document.getElementById('messageInput').value.trim();
      console.log(`Manual search initiated: "${query}"`);
      
      if (!query) {
        setStatus('❌ Please enter a search term', true);
        return;
      }
      
      searchProducts(query);
    }

    // Navigation - Fixed to prevent conflicts and loops
    function goToPage(page, event) {
      // Prevent default behavior and stop propagation
      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }

      // Update active state
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
      }

      // Add small delay to prevent rapid clicking
      setTimeout(() => {
        switch(page) {
          case 'home':
            if (window.location.pathname.includes('index.html') || window.location.pathname === '/') {
              // Already on home, just scroll to top
              window.scrollTo(0, 0);
            } else {
              window.location.href = 'index.html';
            }
            break;
          case 'signin':
            showNotification('🔑 Sign In page coming soon! Browse as guest for now.');
            break;
          case 'createaccount':
            showNotification('👤 Create Account page coming soon! Browse as guest for now.');
            break;
          case 'catalog':
            if (window.location.pathname.includes('chat.html')) {
              // Already on catalog page, scroll to top and refresh with global
              window.scrollTo(0, 0);
              document.getElementById('messageInput').value = 'global';
              searchProducts('global');
            } else {
              window.location.href = 'chat.html?query=global';
            }
            break;
          case 'askme':
            if (window.location.pathname.includes('chat.html')) {
              // Already on chat page, just scroll to top
              window.scrollTo(0, 0);
            } else {
              window.location.href = 'chat.html';
            }
            break;
        }
      }, 100);
    }

    // Handle Enter key
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    // Initialize on page load
    window.addEventListener('load', async function() {
      console.log('🚀 Beauty Products Search initialized');
      
      // Test server connection first
      const serverOnline = await testConnection();
      
      if (!serverOnline) {
        document.getElementById('product-list').innerHTML = `
          <div class="error-message">
            ⚠️ Server Connection Issue<br>
            <small>Unable to connect to the beauty products server.</small><br>
            <button class="load-more-button" onclick="testConnection()" style="margin-top: 15px;">
              Test Connection
            </button>
            <button class="load-more-button" onclick="searchProductsDirect('global')" style="margin-top: 10px;">
              Try Direct Search
            </button>
          </div>
        `;
      } else {
        setStatus('✅ Ready to search for beauty products!');
        
        // Check for query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('query');
        if (query) {
          document.getElementById('messageInput').value = query;
          searchProducts(query);
        }
      }
    });
  </script>
</body>
</html>
