<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
<title>Beauty Chat - Luminous AI</title>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#B8860B" name="theme-color"/>
<style>
/* --- Keep all your original CSS here --- */
:root {
    --primary-charcoal: #2C2C2C;
    --luminous-gold: #B8860B;
    --pearl-white: #F8F8F8;
    --premium-gradient: linear-gradient(135deg, #B8860B, #DAA520);
}
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--primary-charcoal); color: white; margin: 0; min-height:100vh; }
.container { max-width: 414px; margin: 0 auto; display: flex; flex-direction: column; }
.header { background: var(--primary-charcoal); padding: 20px; text-align: center; border-bottom: 1px solid #3A3A3A; position: sticky; top: 0; z-index: 100; }
.back-btn { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); background: var(--premium-gradient); color: white; border: none; border-radius: 20px; padding: 8px 16px; font-size: 14px; cursor: pointer; text-decoration: none; }
.logo { font-size: 24px; font-weight: 700; background: var(--premium-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.chat-area { flex: 1; padding: 20px; background: var(--pearl-white); color: #333; overflow-y: auto; }
.message { margin-bottom: 15px; display: flex; }
.message.user { justify-content: flex-end; }
.message-content { background: white; padding: 12px 16px; border-radius: 16px; max-width: 80%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.message.user .message-content { background: var(--premium-gradient); color: white; }
.product-card { background: white; border:1px solid #e0e0e0; border-radius:12px; padding:12px; margin-bottom:12px; }
.product-name { font-weight:bold; font-size:14px; margin-bottom:6px; }
.product-price { color:var(--luminous-gold); font-weight:bold; }
/* "Show More" button style */
.show-more-btn { background: var(--premium-gradient); color: white; border: none; border-radius: 20px; padding: 10px 20px; font-size: 14px; cursor: pointer; margin: 10px auto; display: block; }
.input-area { padding: 12px 20px; border-top: 1px solid #3A3A3A; display: flex; gap: 10px; background: var(--primary-charcoal); position: sticky; bottom: 0; }
.message-input { flex: 1; border: none; outline: none; font-size: 14px; padding: 10px 14px; border-radius: 25px; }
.send-btn { background: var(--premium-gradient); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <a class="back-btn" href="index.html">← Home</a>
    <div class="logo">✨ Beauty Chat</div>
  </div>

  <div class="chat-area" id="chatArea">
    <!-- Messages and products will appear here -->
  </div>

  <div class="input-area">
    <input class="message-input" id="messageInput" placeholder="Ask about beauty products..." onkeypress="if(event.key==='Enter') sendMessage()"/>
    <button class="send-btn" onclick="sendMessage()">▶</button>
  </div>
</div>

<script>
const BACKEND = "https://beauty-ai-backend.onrender.com";
let allProducts = [];
let showCount = 0;
const BATCH = 25;

// Scroll to bottom helper
function scrollBottom() {
  const area = document.getElementById('chatArea');
  area.scrollTop = area.scrollHeight;
}

// Add message (user or bot)
function appendMessage(sender, text) {
  const area = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = sender === 'user' ? 'message user' : 'message';
  div.innerHTML = `<div class="message-content">${text}</div>`;
  area.appendChild(div);
  scrollBottom();
}

// Display next product batch
function showNextBatch() {
  const area = document.getElementById('chatArea');
  const slice = allProducts.slice(showCount, showCount + BATCH);
  slice.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `<div class="product-name">${p.name}</div><div class="product-price">${p.price || ''}</div><div>${p.description||''}</div>`;
    area.appendChild(card);
  });
  showCount += slice.length;
  scrollBottom();

  // Show or hide the "Show More" button
  document.getElementById('showMoreBtn')?.remove();
  if (showCount < allProducts.length) {
    const btn = document.createElement('button');
    btn.id = 'showMoreBtn';
    btn.className = 'show-more-btn';
    btn.textContent = 'Show More';
    btn.onclick = showNextBatch;
    document.getElementById('chatArea').appendChild(btn);
  }
}

// Fetch products by category
async function fetchForCategory(cat) {
  appendMessage('bot', '✨ Thinking...');
  try {
    const res = await fetch(`${BACKEND}/ask-claude`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ category: cat })
    });
    const { products } = await res.json();
    if (products && products.length > 0) {
      allProducts = products;
      document.querySelector('.message.bot .message-content').textContent = `Here are ${products.length} products for "${cat}":`;
      showNextBatch();
    } else {
      document.querySelector('.message.bot .message-content').textContent = '❌ No products found.';
    }
  } catch {
    document.querySelector('.message.bot .message-content').textContent = '❌ AI service error. Try again.';
  }
}

// Send message function
function sendMessage() {
  const input = document.getElementById('messageInput');
  const msg = input.value.trim();
  if (!msg) return;
  appendMessage('user', msg);
  input.value = '';
  allProducts = []; showCount = 0;
  fetchForCategory(msg);
}

// Auto-start if URL has category
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const cat = params.get('category');
  if (cat) {
    document.getElementById('messageInput').value = cat;
    appendMessage('user', cat);
    fetchForCategory(cat);
  }
});
</script>
</body>
</html>
